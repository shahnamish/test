#!/bin/bash
# Run comprehensive vulnerability scanning

set -e

echo "Starting vulnerability scanning..."

# Check for Python dependencies vulnerabilities
echo "Running safety check..."
if command -v safety &> /dev/null; then
    safety check --full-report || echo "Safety found vulnerabilities"
else
    echo "Safety not installed; skipping."
fi

# Check for Python code vulnerabilities
echo "Running bandit..."
if command -v bandit &> /dev/null; then
    bandit -r services -f json -o reports/bandit.json || echo "Bandit found issues"
else
    echo "Bandit not installed; skipping."
fi

# Check for container vulnerabilities (if Dockerfile exists)
echo "Running trivy..."
if command -v trivy &> /dev/null; then
    trivy fs --format json --output reports/trivy.json ./
else
    echo "Trivy not installed; skipping."
fi

echo "Vulnerability scanning completed. Check reports/ directory for results."
